<html lang="en">


    <head>

        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">

        <title>Pickle Predictor</title>
        <link rel="stylesheet" href="{{ url_for('static', filename='main_style.css') }}">
        
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/simple-line-icons/2.4.1/css/simple-line-icons.css" />
        <link href='https://fonts.googleapis.com/css?family=Freeman' rel='stylesheet'>
        <link rel="icon" type="image/x-icon" href="static/pickleball-small.ico">

    </head>


    <body>

        <div id="side-image-left"></div>
        <div id="side-image-right"></div>

        <div class="container">
            <h1>Pickle Predictor</h1>
            <!-- <p id="sub-heading">Make selections below and see who will win!</p> -->
            <p id="start-instructions">Select partners to play doubles or leave empty for singles.</p>

            <div class="input-wrapper">
                <label for="game-session-num">Select what number game this is in the session</label>
                <div class="slider">
                    <input type="range" id="game-session-num" min="1" max="5" value="1">
                    <div id="game-session-num-input"></div>
                </div>
            </div>

            <div class="input-wrapper">
                <label for="server-select">Select who serves first:</label>
                <select id="server-select">
                    <option value="becca">Becca</option>
                    <option value="julianna">Julianna</option>
                </select>
            </div>
            
            <div class="predict-button">
                <button id="predict" onclick="predict()">Predict Winner</button> 
            </div>

            <div id="court-container">
                <img id="court" src="static/images/court-removebg-preview.png"/>

                <img id="becca" src="static/images/becca4.png" style="--x: 50%; --y: 70%;" class="player"/>
                <img id="julianna" src="static/images/julianna.png" class="player"/>
    
                <div id="becca-partners" class="triangle-layout">
                    <img src="static/images/tori.png" id="tori_becca" class="player light-up"/>
                    <img src="static/images/alex.png" id="alex_becca" class="player light-up"/>
                    <img src="static/images/taylor2.png" id="taylor_becca" class="player light-up"/>
                </div>
                
                <div id="julianna-partners" class="triangle-layout">
                    <img src="static/images/tori.png" id="tori_julianna" class="player light-up"/>
                    <img src="static/images/alex.png" id="alex_julianna" class="player light-up"/>
                    <img src="static/images/taylor2.png" id="taylor_julianna" class="player light-up"/>
                </div>
            </div>

            <div id="winnerPopUp" class="modal">
                <div class="modal-content">
                    <span class="close-button" onclick="closeWinner()">&times;</span>
                    <p id="winnerText"></p>
                </div>
            </div>
        
        </div>


        <script>
            // Partner selection

            // Image opacity change 
            var becca_partner_images = document.querySelectorAll("#becca-partners .light-up");
            var julianna_partner_images = document.querySelectorAll("#julianna-partners .light-up");

            // Add click event listener to each image
            julianna_partner_images.forEach(function(image) {
                image.addEventListener("click", function() {
                    // Toggle opacity between .5 and 1 for the clicked image
                    var currentOpacity = parseFloat(image.style.opacity);
                    image.style.opacity = (currentOpacity === 1) ? 0.4 : 1;

                    // Get the ID of the clicked image
                    var clickedImageId = image.id;

                    // Set opacity to 0.5 for all images except the clicked one
                    julianna_partner_images.forEach(function(img) {
                        if (img.id !== clickedImageId) {
                            img.style.opacity = 0.4;
                        }
                    });
                });
            });

            becca_partner_images.forEach(function(image) {
                image.addEventListener("click", function() {
                    // Toggle opacity between .5 and 1 for the clicked image
                    var currentOpacity = parseFloat(image.style.opacity);
                    image.style.opacity = (currentOpacity === 1) ? 0.4 : 1;

                    // Get the ID of the clicked image
                    var clickedImageId = image.id;

                    // Set opacity to 0.5 for all images except the clicked one
                    becca_partner_images.forEach(function(img) {
                        if (img.id !== clickedImageId) {
                            img.style.opacity = 0.4;
                        }
                    });
                });
            });

            // Game Num Slider 

            var slider = document.getElementById("game-session-num");
            var output = document.getElementById("game-session-num-input");
            output.innerHTML = slider.value; // Display the default slider value

            // Update the current slider value (each time you drag the slider handle)
            slider.oninput = function() {
            output.innerHTML = this.value;
            };

            // Predict Button

            var predictButton = document.getElementById("predict");

            // Add a click event listener to the button
            predictButton.addEventListener("click", function() {
                
                // Add the CSS class to the button when it's clicked
                predictButton.classList.add("button-clicked");

                // Remove the CSS class after a short delay
                setTimeout(function() {
                    predictButton.classList.remove("button-clicked");
                }, 100); // Adjust the delay (in milliseconds) as needed
            
            });

            // Main prediction function
            function predict() {
                // Get the ID of becca's partner (lit up image)
                var beccaPartnerID = "";
                var beccaPartner = document.querySelector("#becca-partners .light-up[style='opacity: 1;']");
                if (beccaPartner) {
                    beccaPartnerID = beccaPartner.id;
                }

                // Get the ID of julianna's partner (lit up image)
                var juliannaPartnerID = "";
                var juliannaPartner = document.querySelector("#julianna-partners .light-up[style='opacity: 1;']");
                if (juliannaPartner) {
                    juliannaPartnerID = juliannaPartner.id;
                }

                // Get first server
                var serve = document.getElementById("server-select").value;

                // Get game num
                var gameNum = document.getElementById("game-session-num").value;

                // Send the information to the Flask app
                fetch('/predict', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ 
                        becca_partner: beccaPartnerID, 
                        julianna_partner: juliannaPartnerID, 
                        serve: serve,
                        game_num: gameNum
                    })
                }).then(response => {
                    if (response.ok) {
                        return response.json(); // Parse response as JSON
                    } else {
                        throw new Error('Failed to send information.');
                    }
                }).then(data => {
                    showWinner(data.message); // Show the modal with the result

                }).catch(error => {
                    console.error("Error:", error);
                });
            }
            
            // Modal to show results
            function showWinner(text) {
                document.getElementById('winnerText').innerText = text; // Set the text
                document.getElementById('winnerPopUp').style.display = 'block'; // Show the modal
            }

            function closeWinner() {
                document.getElementById('winnerPopUp').style.display = 'none'; // Hide the modal
            }   


        </script>

    </body>


</html>